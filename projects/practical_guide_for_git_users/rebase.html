

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Rebase &mdash; Practical guide for git users 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Practical guide for git users 0.1 documentation" href="index.html"/>
        <link rel="next" title="GitLab介紹" href="gitlab.html"/>
        <link rel="prev" title="Git flow 分支策略" href="branchingmodel.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Practical guide for git users</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">安裝說明</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurations.html">Git基本設定</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configurations.html#first-thing-first">First thing first.</a></li>
<li class="toctree-l2"><a class="reference internal" href="configurations.html#push">設定預設的推送(Push)模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="configurations.html#id1">設定不需版本控制的檔案</a></li>
<li class="toctree-l2"><a class="reference internal" href="configurations.html#gitdiff">設定Git預設所使用的diff演算法</a></li>
<li class="toctree-l2"><a class="reference internal" href="configurations.html#id3">設定好用的Git指令縮寫</a></li>
<li class="toctree-l2"><a class="reference internal" href="configurations.html#id4">其他</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Git必懂指令</a><ul>
<li class="toctree-l2"><a class="reference internal" href="commands.html#id2">單人開發模式 - 新增篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#id4">單人開發模式 - 修改篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#id5">單人開發模式 - 刪除篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#id6">單人開發模式 - 刪除Git日誌中的資料</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#id7">多人合作開發模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#ssh">多人合作開發模式 - 設定SSH金鑰認證</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="branchingmodel.html">Git flow 分支策略</a><ul>
<li class="toctree-l2"><a class="reference internal" href="branchingmodel.html#master">主分支(Master)</a></li>
<li class="toctree-l2"><a class="reference internal" href="branchingmodel.html#feature-release-hotfix">支援分支(feature, release, hotfix)</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Rebase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">什麼是 rebase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Rebase - 基礎用法</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Rebase - 進階互動模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Rebase 出現問題時的處理方法</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gitlab.html">GitLab介紹</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gitlab.html#self-hosted-git-management-software">Self hosted Git management software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gitlabworkflow.html">GitLab工作流程</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gitlabworkflow.html#id1">建立新專案</a></li>
<li class="toctree-l2"><a class="reference internal" href="gitlabworkflow.html#id2">匯入公鑰</a></li>
<li class="toctree-l2"><a class="reference internal" href="gitlabworkflow.html#id3">開放專案</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">參考資料</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Practical guide for git users</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Rebase</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/rebase.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="rebase">
<h1>Rebase<a class="headerlink" href="#rebase" title="Permalink to this headline">¶</a></h1>
<p>常言道「不會 <cite>rebase</cite> ，就等於沒學過 Git」，由此可見 <cite>rebase</cite>  在 Git 內有多重要。</p>
<p>在開始本文之前，請大家牢記「千萬不要對已經 <cite>push</cite> 到 <strong>遠端儲存庫(remote repository)</strong> 的提交進行 <cite>rebase</cite> 」，這是很危險的！詳情請見 <a class="reference external" href="http://git-scm.com/book/en/Git-Branching-Rebasing#The-Perils-of-Rebasing">The Perils of Rebasing</a></p>
<p>改變過去是很危險的！請牢記在心！</p>
<p>接下來，本文會說明什麼是 <cite>rebase</cite> ，並且介紹 <cite>rebase</cite>  的幾個基本用法。</p>
<div class="section" id="id1">
<h2>什麼是 rebase<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Rebase 對於很多人來說是一個很抽象的概念，也因此它的學習門檻就在於如何了解這個抽象的概念。對於 <cite>rebase</cite>  比較恰當的比喻應該是「移花接木」，簡單來講把你的分支接到別的分支上，稍後我們用幾個圖來示範 merge 與 <cite>rebase</cite>  的差異。</p>
<p>了解 <cite>rebase</cite> 之前，我們必須了解什麼是 <cite>base</cite> 。對 Git 的使用者而言，在分支中進行開發活動是稀鬆平常的事情，也因此在合併管理分支時，也就需要了解分支是在哪個時間點哪個提交點分出來的旁支，而長出旁支來的提交點，對於旁支來說就是 <cite>base commit</cite> ，也就是 <cite>base</cite> 。所以簡單來說， <cite>rebase</cite> 其實就是改變分支的 <cite>base</cite> 的功能。</p>
<p>下圖是在 merge 的情況會產生的版本演進的示意圖，可以看到在新的分支中所做的變更，在合併之後，一併成為一個新的提交(commit 6)。而 <cite>commit 1</cite> 就是 New Branch 的 <cite>base</cite> 。</p>
<div class="figure align-center">
<img alt="_images/merge.png" src="_images/merge.png" />
<p class="caption">Merge 的示意</p>
</div>
<p>而下圖是 <cite>rebase</cite>  的情況下會產生的版本演進的示意圖。我們同樣是在分支中進行開發的動作，但是在 <cite>rebase</cite> 時，與 merge 不同的是，Git 會將分支上所做的變更先暫存起來，接著把 <cite>newbase</cite> (或稱新基準點)合併進來，最後直接將剛剛暫存起來的變更在分支上重演，這邊用「重演」這個字眼是表示「 <strong>rebase 不是將提交(commit)複製到分支上，而是將整個變更過程一個一個重新套用到分支上</strong> 」，也就因為如此 <cite>commit 2&#8217;</cite> 與 <cite>commit 3&#8217;</cite> ，才會有另外的 <cite>&#8216;</cite> 符號表示與原本的 <cite>commit 2</cite> , <cite>commit 3</cite> 不同，這點可以從 commit 的 SHA1 湊值不同看出來，雖然變更的內容相同，但是 commit 編號是不同的。本文會在稍後利用範例演示一遍。</p>
<div class="figure align-center">
<img alt="_images/rebase.png" src="_images/rebase.png" />
<p class="caption">Rebase 的示意</p>
</div>
<p>也就因為如此，所以 <cite>rebase</cite> 的行為就很像「移花接木」，以上圖來說，就是把 New Branch 的變更整個接到 Master 上。</p>
<p>接下來的文章中，將會傳授 <cite>rebase</cite>  的 2 大主軸：</p>
<ul class="simple">
<li>基礎用法</li>
<li>進階互動模式</li>
</ul>
<p>在基礎用法中，我們將教授 <cite>rebase</cite> 分支剪接的部分。</p>
<p>而進階互動模式中將會說明如何交換提交次序、修改提交內容、合併提交內容，甚至將一個提交拆解成多個提交。</p>
</div>
<div class="section" id="id2">
<h2>Rebase - 基礎用法<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>以下我們用一個情境示範 <cite>rebase</cite> 的「基礎用法」：</p>
<blockquote>
<div><p>你是一位 team leader，你的其中一項職務就是負責進行程式碼審查(code review)，並且將不同程式分支進行合併管理。</p>
<p>現在有 2 位程式設計師以 <cite>develop</cite> 分支為基礎，分別開了新的分支 <cite>feature-a</cite> 與 <cite>feature-b</cite> ，也都已經完工了。
你希望利用 <cite>rebase</cite> 的方式將這 2 個分支併入 <cite>develop</cite> 中。</p>
</div></blockquote>
<p>首先， <cite>develop</cite> 的日誌如下所示：</p>
<div class="highlight-python"><div class="highlight"><pre>commit 38844ba14312c642dcd0f72baf031de0c50ad736
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:41:04 2014 +0800

    add HelloWorld.c

commit 3908e6bc1007f12566fdb5a0fb43f4055560b880
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:40:42 2014 +0800

    initial commit
</pre></div>
</div>
<p>接著， <cite>feature-a</cite> 的日誌如下所示:</p>
<div class="highlight-python"><div class="highlight"><pre>commit 15bf9c8954633700211f5b9d246ae67d8135cf29
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:42:48 2014 +0800

    add feature_a.c

commit 38844ba14312c642dcd0f72baf031de0c50ad736
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:41:04 2014 +0800

    add HelloWorld.c

commit 3908e6bc1007f12566fdb5a0fb43f4055560b880
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:40:42 2014 +0800

    initial commit
</pre></div>
</div>
<p>最後是 <cite>feature-b</cite> 的日誌：</p>
<div class="highlight-python"><div class="highlight"><pre>commit e9d7a6f8b27bca86ef298911d84891b8a7efeada
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:45:37 2014 +0800

    add #include &lt;stdio.h&gt;

commit eb6436b59b7a0624f3ec5e5469ac36b37b5211e7
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:43:55 2014 +0800

    add feature_b.c

commit 38844ba14312c642dcd0f72baf031de0c50ad736
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:41:04 2014 +0800

    add HelloWorld.c

commit 3908e6bc1007f12566fdb5a0fb43f4055560b880
Author: one.man.army &lt;one.man.army@example.com&gt;
Date:   Mon Sep 22 15:40:42 2014 +0800

    initial commit
</pre></div>
</div>
<p>可以看到 <cite>feature-a</cite> 與 <cite>feature-b</cite> 分別比 <cite>develop</cite> 多出了 1, 2 個提交。</p>
<p>身為一名專業的 team leader，我們有著足夠的信心，相信這 2 個分支運作的很好，因此我們用以下指令進行 <cite>rebase</cite> 。</p>
<div class="highlight-python"><div class="highlight"><pre>$ git checkout develop
$
$ git rebase feature-a
First, rewinding head to replay your work on top of it...
Fast-forwarded develop to feature-a.
$
$ git rebase feature-b
First, rewinding head to replay your work on top of it...
Applying: add feature_a.c
</pre></div>
</div>
<p>在上述指令中，我們先切換到 <cite>develop</cite> 分支中，接著我們很快的就利用指令 <cite>git rebase &lt;newbase&gt;</cite> 合併了 <cite>feature-a</cite> 與 <cite>feature-b</cite> 。此外，在上述的指令執行結果中，可以看到一行訊息顯示 <cite>Fast-forwarded develop to feature-a</cite> ，其中的 <cite>Fast-forwarded</cite> 是什麼意思呢？</p>
<blockquote>
<div><cite>Fast-forwarded</cite> 指的就是當 2 個分支的頭尾相接時，代表 2 者之間不會有 conflict ，因此只要改 HEAD 的指向就能夠迅速合併了。以本情境為例， <cite>develop</cite> 的最後一個提交正好是 <cite>feature-a</cite> 的頭，所以這兩者的 <cite>rebase</cite> 適用 <cite>Fast-forwarded</cite> 模式。</div></blockquote>
<p>接下來，可以用 <cite>git log</cite> 看看 <cite>develop</cite> 的日誌，我們可以從日誌中發現 <cite>feature-a</cite> 與 <cite>feature-b</cite> 的 <cite>commit ID</cite> 都不一樣了。</p>
<div class="highlight-python"><div class="highlight"><pre>$ git log
commit 07ef0b8e0b1edd079fb8b69f6e6e215725b5aba4
Author: spitfire-sidra &lt;spitfire.sidra@gmail.com&gt;
Date:   Mon Sep 22 15:42:48 2014 +0800

    add feature_a.c

commit e9d7a6f8b27bca86ef298911d84891b8a7efeada
Author: spitfire-sidra &lt;spitfire.sidra@gmail.com&gt;
Date:   Mon Sep 22 15:45:37 2014 +0800

    add #include &lt;stdio.h&gt;

commit eb6436b59b7a0624f3ec5e5469ac36b37b5211e7
Author: spitfire-sidra &lt;spitfire.sidra@gmail.com&gt;
Date:   Mon Sep 22 15:43:55 2014 +0800

    add feature_b.c

commit 38844ba14312c642dcd0f72baf031de0c50ad736
Author: spitfire-sidra &lt;spitfire.sidra@gmail.com&gt;
Date:   Mon Sep 22 15:41:04 2014 +0800

    add HelloWorld.c

commit 3908e6bc1007f12566fdb5a0fb43f4055560b880
Author: spitfire-sidra &lt;spitfire.sidra@gmail.com&gt;
Date:   Mon Sep 22 15:40:42 2014 +0800

    initial commit
</pre></div>
</div>
<p>以上就是最簡單的 <cite>rebase</cite> 過程。</p>
<p>但是在這過程中，有些人可能產生了幾個疑問——「為什麼先 <cite>rebase feature-a</cite> 再 <cite>rebase feature-b</cite> 後，會是 <cite>feature-a</cite> 的日誌在最上方呢？」</p>
<p>這是由於 <cite>rebase</cite> 會先找出與 <cite>newbase</cite> 之間最近的一個共同 <cite>base</cite> ，然後先保留 HEAD 所在分支(也就是當前分支)從共同 <cite>base</cite> 開始的所有變更，接著從共同 <cite>base</cite> 開始，將 <cite>newbase</cite> 的變更重新套用到 HEAD 的所在分支後，再將方才所保留的當前分支變更一個一個套用進來，也因此 <cite>feature-a</cite> 會是最後的一個 <cite>commit</cite> 。</p>
<p>我們一樣以圖示進行說明。下圖 <strong>After rebase feature-a</strong> 是 <cite>rebase feature-a</cite> 之後的樣子，可以看到 <cite>rebase feature-a</cite> 之後 <cite>develop</cite> 與 <cite>feature-b</cite> 的共同 <cite>base</cite> 是 <cite>commit 38844b</cite> ，因此如果要再 <cite>rebase feature-b</cite> 的話， <cite>commit 15bf9c</cite> 會先被暫存起來，先進行 <cite>rebase feature-b</cite> 之後，再將剛剛暫存的 <cite>commit 38844b</cite> 重演一次，所以在圖 <strong>After rebase feature-b</strong> 中 <cite>feature-a</cite> 的 <cite>commit ID</cite> 就從 <cite>338844b</cite> 變成 <cite>07ef0b</cite> ，這就是 <cite>rebase</cite> 的過程了。</p>
<div class="figure align-center">
<img alt="_images/rebase_feature_a.png" src="_images/rebase_feature_a.png" />
<p class="caption">After rebase feature-a</p>
</div>
<div class="figure align-center">
<img alt="_images/rebase_feature_b.png" src="_images/rebase_feature_b.png" />
<p class="caption">After rebase feature-b</p>
</div>
<p>問題又來了，剛剛學的 <cite>rebase</cite> 會將整個分支都接上去，有時候我們不需要整個分支都接上去，只要接到分支上的某個提交的點即可，這種情況下可以使用 <cite>rebase &#8211;onto</cite> 進行。</p>
<p>假設只需要接到 <cite>feature-b</cite> 的 <cite>commit eb6436</cite> 時，就可以用以下指令進行 <cite>rebase</cite> ：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git rebase feature-b --onto eb6436
</pre></div>
</div>
<p>又或者，想要把我們現在的分支整個接到某個分支點上面時，可以選擇另一種用法：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git rebase --onto &lt;new base-commit&gt; &lt;current base-commit&gt;
</pre></div>
</div>
<p>例如，我們在 <cite>feature-b</cite> 分支上時，想把整個分支接到 <cite>commit 3908e6</cite> (initial commit) 時，可以輸入以下指令：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git co feature-b #先切換到 feature-b
$ git rebase --onto 3908e6 38844b
</pre></div>
</div>
<p>下面 2 張圖就是執行上述指令的前後對照。</p>
<div class="figure align-center">
<img alt="_images/before_rebase_onto.png" src="_images/before_rebase_onto.png" />
<p class="caption">before rebase &#8211;onto 3908e6 38844b</p>
</div>
<div class="figure align-center">
<img alt="_images/after_rebase_onto.png" src="_images/after_rebase_onto.png" />
<p class="caption">after rebase &#8211;onto 3908e6 38844b</p>
</div>
</div>
<div class="section" id="id3">
<h2>Rebase - 進階互動模式<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><cite>Rebase</cite> 的互動模式十分強大，可以允許我們交換提交的次序、修改提交內容、合併提交內容，甚至將一個提交拆解成多個提交。</p>
<p>要進入互動模式的基本指令如下， <cite>base commit</cite> 可以是分支上的任意一點：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git rebase -i &lt;base commit&gt;
</pre></div>
</div>
<p>例如，我們想利用互動模式將 <cite>feature-b</cite> 上的提交做一些整理時，就可以用以下指令進入互動模式：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git rebase -i 38844b
</pre></div>
</div>
<p>上述指令的意思就是我們希望將 <cite>feature-b</cite> 從 <cite>commit 38844b</cite> 之後的所有提交(不含 <cite>commit 38844b</cite> )進行整理。</p>
<p>接著就會出現類似以下的訊息：</p>
<div class="highlight-python"><div class="highlight"><pre>pick 1011f14 add feature_b.c
pick d26076a add #include &lt;stdio.h&gt;

# Rebase 38844ba..d26076a onto 38844ba
#
# Commands:
#  p, pick = use commit
#  r, reword = use commit, but edit the commit message
#  e, edit = use commit, but stop for amending
#  s, squash = use commit, but meld into previous commit
#  f, fixup = like &quot;squash&quot;, but discard this commit&#39;s log message
#  x, exec = run command (the rest of the line) using shell
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</pre></div>
</div>
<p>在進一步操作前，我們必須對訊息上的幾個指令(commands)進行說明：</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">pick:</th><td class="field-body">保留此提交</td>
</tr>
<tr class="field-even field"><th class="field-name">reword:</th><td class="field-body">修改提交的訊息(只改提交訊息)</td>
</tr>
<tr class="field-odd field"><th class="field-name">edit:</th><td class="field-body">保留此提交，但是需要做一些修改(例如在程式裡面多加些註解)</td>
</tr>
<tr class="field-even field"><th class="field-name">squash:</th><td class="field-body">保留此提交，但是將上面的提交一併併入此提交，此動作會顯示提交訊息供人編輯</td>
</tr>
<tr class="field-odd field"><th class="field-name">fixup:</th><td class="field-body">與squash相似，但是此提交的提交訊息會被上面的提交訊息取代</td>
</tr>
<tr class="field-even field"><th class="field-name">exec:</th><td class="field-body">執行 shell 指令，例如 <strong>exec make test</strong> 進行一些測試，可以隨意穿插在提交點之間</td>
</tr>
</tbody>
</table>
<div class="section" id="id4">
<h3>變換順序<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>接下來，簡單示範變換提交的順序，此處我們想把提交的順序變成先 <cite>commit 1011f14</cite> 再來才是 <cite>commit d26076a</cite> ，我們只要簡單將上述的 <cite>rebase</cite> 訊息換成如下的訊息，也就是兩行互換即可，就能夠變換順序了！</p>
<div class="highlight-python"><div class="highlight"><pre># 此處調換次序即可
pick d26076a add #include &lt;stdio.h&gt;
pick 1011f14 add feature_b.c

# Rebase 38844ba..d26076a onto 38844ba
#
# Commands:
#  p, pick = use commit
#  r, reword = use commit, but edit the commit message
#  e, edit = use commit, but stop for amending
#  s, squash = use commit, but meld into previous commit
#  f, fixup = like &quot;squash&quot;, but discard this commit&#39;s log message
#  x, exec = run command (the rest of the line) using shell
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>修改提交內容<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>有些時候，我們提交之後，不免會註解忘了加或是程式內還有測試的code忘記清掉。這時候除了用 <cite>git reset &#8211;soft HEAD^</cite> 之外，也可以用 <cite>rebase</cite> 編輯那些需要修正的提交。</p>
<p>例如，我們希望用 <cite>rebase</cite> 在 <cite>commit 1011f14</cite> 中添加幾個提交，就可以將 <cite>pick</cite> 改成 <cite>edit</cite> 進入編輯狀態。</p>
<div class="highlight-python"><div class="highlight"><pre>pick 1011f14 add feature_b.c
edit d26076a add #include &lt;stdio.h&gt;

# Rebase 38844ba..d26076a onto 38844ba
#
# Commands:
#  p, pick = use commit
#  r, reword = use commit, but edit the commit message
#  e, edit = use commit, but stop for amending
#  s, squash = use commit, but meld into previous commit
#  f, fixup = like &quot;squash&quot;, but discard this commit&#39;s log message
#  x, exec = run command (the rest of the line) using shell
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</pre></div>
</div>
<p>接下來，如果用 <cite>git status</cite> 就可以看到我們正在 <cite>rebase</cite> 的訊息：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git status
rebase in progress; onto 38844ba
You are currently editing a commit while rebasing branch &#39;Feature-B&#39; on &#39;38844ba&#39;.
  (use &quot;git commit --amend&quot; to amend the current commit)
  (use &quot;git rebase --continue&quot; once you are satisfied with your changes)

nothing to commit, working directory clean
</pre></div>
</div>
<p><strong>如果你只是想修正提交訊息</strong> ，就可以用以下指令 ：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git commit --amend
</pre></div>
</div>
<p><strong>如果你需要多增加幾個提交，直接編輯吧</strong> ，接著用 <cite>git add &lt;file&gt;</cite> , <cite>git commit -m &lt;message&gt;</cite> 等一般操作進行。最後再利用以下指令完成 <cite>rebase</cite> ：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git rebase --continue
</pre></div>
</div>
<p><strong>又或者，我們現在編輯的提交實在是太大了，可能對程式碼審查的人造成困擾，例如同時修正太多個檔案，我們希望拆成比較明確的多個提交</strong> ，就可以用以下指令回到未提交前的狀態：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git reset HEAD^
</pre></div>
</div>
<p>然後就可以用 <cite>git status</cite> 列出這個提交中變更了多少檔案，然後依照需求一個一個用 <cite>git add</cite> 加進去後提交，多提交個幾次，就等於是將一個提交拆成多個提交囉！不過別忘了，要用以下指令結束 <cite>rebase</cite> 。</p>
<div class="highlight-python"><div class="highlight"><pre>$ git rebase --continue
</pre></div>
</div>
<p>以上就是 <cite>rebase</cite> 的幾個簡單說明與操作。</p>
<p>至於 <cite>squash</cite> , <cite>fixup</cite> 以及 <cite>exec</cite> 就留給各位去體驗了！</p>
</div>
</div>
<div class="section" id="id6">
<h2>Rebase 出現問題時的處理方法<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p><cite>Rebase</cite> 與 <cite>merge</cite> 一樣都可能會產生 <strong>conflict</strong> ，這時候除了修正 <strong>conflict</strong> 之後再用 <cite>git add &lt;file&gt;</cite> , <cite>git rebase &#8211;continue</cite> 完成 <cite>rebase</cite> 之外，也可以用 <cite>git rebase &#8211;abort</cite> 直接放棄 <cite>rebase</cite> 。</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase (--continue | --abort | --skip)
</pre></div>
</div>
<p>此外，對於 <cite>rebase</cite> 使用不慎時，我們會希望能夠直接回復到 <cite>rebase</cite> 之前的狀態，以下就是幾個指令可以用來回復到 <cite>rebase</cite> 之前的狀態。 參考自 <a class="reference external" href="http://stackoverflow.com/questions/134882/undoing-a-git-rebase">StackOverFlow</a> 。</p>
<p>回復方法 1 ：</p>
<div class="highlight-python"><div class="highlight"><pre># 最簡單的用法
$ git reset --hard ORIG_HEAD
</pre></div>
</div>
<p>回復方法 2 ：</p>
<div class="highlight-python"><div class="highlight"><pre># rebase 之前先上 tag
$ git tag BACKUP
$ ... # rebase 過程
$ ... # rebase 過程
$ git reset --hard BACKUP # 失敗的話可以直接回復到 tag BACKUP
</pre></div>
</div>
<p>回復方法 3 ：</p>
<div class="highlight-python"><div class="highlight"><pre>$ git reflog # 尋找要回復的 HEAD ，以下假設是 HEAD@{3}
$ git reset --hard HEAD@{3} # 回復
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gitlab.html" class="btn btn-neutral float-right" title="GitLab介紹"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="branchingmodel.html" class="btn btn-neutral" title="Git flow 分支策略"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, PwnDora.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>